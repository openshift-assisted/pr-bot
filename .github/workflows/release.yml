name: Release

on:
  push:
    tags: ['v*']

jobs:
  release:
    runs-on: ubuntu-latest
    # Only maintainers with access to private data can release
    if: github.repository == 'shay23bra/pr-bot' && github.actor == 'shay23bra'
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.21'
    
    - name: Check for required data file
      run: |
        if [ ! -f "data/ACM - Z Stream Release Schedule.xlsx" ]; then
          echo "âŒ Error: Private Excel data file not found"
          echo "ğŸ’¡ Only maintainers with access to private data can create releases"
          echo "ğŸ“‚ Required: data/ACM - Z Stream Release Schedule.xlsx"
          exit 1
        fi
        echo "âœ… Private data file found"
    
    - name: Build with embedded data
      run: ./scripts/build-with-data.sh
    
    - name: Create release
      uses: softprops/action-gh-release@v1
      with:
        name: "${{ github.ref_name }}"
        body: |
          ## ğŸš€ Release with Embedded Data
          
          This release includes embedded Excel data for immediate use:
          
          ### ğŸ“¦ Installation
          ```bash
          go install github.com/shay23bra/pr-bot@${{ github.ref_name }}
          ```
          
          ### âœ¨ Features
          - âœ… **No external files required** - data is embedded
          - âœ… **Works immediately** after installation  
          - âœ… **Self-contained binary** - distribute anywhere
          
          ### ğŸ” Verification
          ```bash
          pr-bot --data-source
          # Should show: "Source: embedded (67339 bytes)"
          ```
          
          ### ğŸ‘¥ For Contributors
          If you're contributing and don't have the private data file:
          ```bash
          go build -tags=filesystem .
          ```
        files: pr-bot
        tag_name: ${{ github.ref_name }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 